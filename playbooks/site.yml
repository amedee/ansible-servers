---
- name: Base configuration for all hosts
  hosts: all
  roles:
    - rolehippie.swap
    - localepurge
    - debops.debops.etckeeper
    - debops.debops.etc_aliases
    - debops.debops.apt_listchanges
    - debops.debops.unattended_upgrades
    - hostname

    - role: merge_vars
      merge_vars_from_1: apt_packages_base
      merge_vars_from_2: apt_packages_extra
      merge_vars_target: apt_packages
    - install_software

    - role: merge_vars
      merge_vars_from_1: cron__jobs_base
      merge_vars_from_2: cron__jobs_extra
      merge_vars_target: cron__jobs
    - debops.debops.cron

    - role: merge_vars
      merge_vars_from_1: munin_node_config_base
      merge_vars_from_2: munin_node_config_extra
      merge_vars_target: munin_node_config
    - role: merge_vars
      merge_vars_from_1: munin_node_install_plugins_base
      merge_vars_from_2: munin_node_install_plugins_extra
      merge_vars_target: munin_node_install_plugins
    - role: merge_vars
      merge_vars_from_1: munin_node_plugins_base
      merge_vars_from_2: munin_node_plugins_extra
      merge_vars_target: munin_node_plugins
    - munin_node

    - postfix
    - postfix_sendgrid
    - debops.debops.logrotate

- name: Configure Mail-in-a-Box servers
  hosts: mailservers
  roles:
    - mailinabox

- name: Configure WordPress servers
  hosts: blogs
  roles:
    - mysql
    - redis
    - nginx
    - blog
